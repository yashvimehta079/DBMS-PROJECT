<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Marriott — Manage User Access</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="access.css" />
</head>

<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg fixed-top glass-nav">
        <div class="container">
            <a class="navbar-brand" href="#">Marriott</a>
            <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navCollapse">
                <i class="fa fa-bars" style="color:#fff"></i>
            </button>

            <div class="collapse navbar-collapse" id="navCollapse">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item me-2"><a class="nav-link" href="admin_dashboard.html" target="_blank">Admin</a>
                    </li>
                    <li class="nav-item me-2"><a class="nav-link" href="staff_dashboard.html" target="_blank">Staff</a>
                    </li>
                    <li class="nav-item me-2"><a class="nav-link" href="guest_dashboard.html" target="_blank">Guest</a>
                    </li>

                    <li class="nav-item me-3 d-flex align-items-center">
                        <div class="form-check form-switch mb-0">
                            <input class="form-check-input" type="checkbox" id="autoRefreshToggle">
                        </div>
                        <small class="ms-2 text-muted">Auto-refresh</small>
                    </li>

                    <li class="nav-item ms-2">
                        <a href="logout.html" class="btn btn-outline-light btn-sm px-3">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <main class="container mt-5 pt-5">
        <h2 class="section-title text-center mt-4 mb-4">
            <i class="fa-solid fa-user-shield me-2 text-gold"></i>Manage User Access
        </h2>

        <!-- TOP CONTROLS / SUMMARY -->
        <div class="row g-3 mb-4">
            <div class="col-lg-8">
                <div class="glass-card p-3 d-flex flex-wrap align-items-center justify-content-between gap-2">
                    <div class="d-flex gap-2 align-items-center flex-wrap">
                        <input id="searchUser" class="form-control" placeholder="Search by username, email or role"
                            style="min-width:240px;">
                        <select id="filterRole" class="form-select" style="max-width:160px;">
                            <option value="">All Roles</option>
                            <option>admin</option>
                            <option>staff</option>
                            <option>guest</option>
                        </select>
                        <select id="filterStatus" class="form-select" style="max-width:160px;">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="revoked">Revoked</option>
                        </select>
                        <button id="refreshBtn" class="btn btn-gold"><i
                                class="fa-solid fa-rotate me-1"></i>Refresh</button>
                    </div>

                    <div class="d-flex gap-2 align-items-center">
                        <button id="exportCsv" class="btn btn-outline-light btn-sm"><i
                                class="fa-solid fa-file-csv me-1"></i>Export CSV</button>
                        <button id="bulkAssignBtn" class="btn btn-outline-light btn-sm"><i
                                class="fa-solid fa-users-cog me-1"></i>Bulk Assign</button>
                    </div>
                </div>
            </div>

            <!-- summary cards -->
            <div class="col-lg-4">
                <div class="d-flex gap-2">
                    <div class="glass-card p-3 text-center flex-fill">
                        <small class="text-muted">Total Users</small>
                        <h4 id="statUsers">—</h4>
                    </div>
                    <div class="glass-card p-3 text-center flex-fill">
                        <small class="text-muted">Admins</small>
                        <h4 id="statAdmins">—</h4>
                    </div>
                    <div class="glass-card p-3 text-center flex-fill">
                        <small class="text-muted">Staff</small>
                        <h4 id="statStaff">—</h4>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN LAYOUT: table + audit panel -->
        <div class="row g-3">
            <!-- TABLE -->
            <div class="col-lg-8">
                <div class="glass-card p-3">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle" id="accessTable">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="chkAll"></th>
                                    <th>User ID</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Privileges</th>
                                    <th>Last Updated</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="accessBody">
                                <!-- injected by JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- pagination & page info -->
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div id="pageInfo" class="text-muted">Showing 0 of 0</div>
                        <div>
                            <button id="prevPage" class="btn btn-outline-light btn-sm me-2">Prev</button>
                            <button id="nextPage" class="btn btn-outline-light btn-sm">Next</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AUDIT LOG -->
            <div class="col-lg-4">
                <div class="glass-card p-3" style="height:100%;">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0 text-muted">Recent Access Changes</h6>
                        <button id="refreshAudit" class="btn btn-sm btn-outline-light"><i
                                class="fa-solid fa-rotate"></i></button>
                    </div>
                    <div id="auditList" style="max-height:520px; overflow:auto;" class="small text-muted">
                        <!-- inserted by JS -->
                        Loading...
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- EDIT MODAL -->
    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content glass-card">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-gold"><i class="fa-solid fa-user-gear me-2"></i>Edit User Access</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <input type="hidden" id="editUserId">
                    <div class="row g-3 mb-3">
                        <div class="col-md-6">
                            <label class="form-label small text-muted">Username</label>
                            <div id="editUsername" class="fw-semibold"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small text-muted">Email</label>
                            <div id="editEmail" class="fw-semibold"></div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small text-muted">Role</label>
                            <select id="editRole" class="form-select">
                                <option value="admin">admin</option>
                                <option value="staff">staff</option>
                                <option value="guest">guest</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small text-muted">Status</label>
                            <select id="editStatus" class="form-select">
                                <option value="active">Active</option>
                                <option value="revoked">Revoked</option>
                            </select>
                        </div>
                    </div>

                    <hr />

                    <div class="mb-3">
                        <label class="form-label small text-muted">Privileges (toggle)</label>
                        <div class="d-flex gap-2 flex-wrap" id="privilegeToggles">
                            <!-- toggles inserted by JS -->
                        </div>
                        <small class="text-muted d-block mt-2">Note: DB-level privileges will be enforced
                            server-side.</small>
                    </div>

                    <div id="editNotes" class="small text-muted"></div>
                </div>

                <div class="modal-footer border-0">
                    <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <button id="saveAccessBtn" class="btn btn-gold">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- BULK ASSIGN MODAL -->
    <div class="modal fade" id="bulkModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-card">
                <div class="modal-header border-0">
                    <h5 class="modal-title text-gold"><i class="fa-solid fa-user-friends me-2"></i>Bulk Update</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted">Selected users: <span id="bulkCount">0</span></p>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Set Role</label>
                        <select id="bulkRole" class="form-select">
                            <option value="">— no change —</option>
                            <option value="admin">admin</option>
                            <option value="staff">staff</option>
                            <option value="guest">guest</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small text-muted">Set Status</label>
                        <select id="bulkStatus" class="form-select">
                            <option value="">— no change —</option>
                            <option value="active">Active</option>
                            <option value="revoked">Revoked</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
                    <button id="applyBulkBtn" class="btn btn-gold">Apply to Selected</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-3 mt-4">
        <p>&copy; 2025 Marriott Hotel | Access Management</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="access.js"></script>
</body>

</html>